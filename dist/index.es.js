/*!
 * websocket-mock v1.0.1 by Mr.Rainüåπ
 * (c) 2019-2019 
 * http://git.tianrang-inc.com:TR-FRONT/ws-mock.git
 * Released under the MIT License.
 */
var e=function(e){var t=0,n=e;return"string"==typeof e?t+=e.length:e instanceof ArrayBuffer?t+=e.byteLength:e instanceof Blob?t+=e.size:e.byteLength?t+=e.byteLength*(e.BYTES_PER_ELEMENT||1):t+=(n=""+e).length,{dataToBeSent:n,dataSize:t}},t=function(e){if("function"!=typeof URL)return"string"==typeof e&&""!==e;var t={};try{t=new URL(e)}catch(t){return"The URL '"+e+"' is invalid."}var n=t.protocol;return"ws:"===n||"wss:"===n||"The URL's scheme must be either 'ws' or 'wss'. '"+n.slice(0,-1)+"' is not allowed."},n=function(e,t){if(typeof e==typeof t&&"string"==typeof e)return e===t;if(e instanceof RegExp&&t instanceof RegExp)return e.toString()===t.toString();var n="",r=e instanceof RegExp?(n=t,e):t instanceof RegExp?(n=e,t):void 0;return void 0!==r&&r.test(n)},r=function(){return~~((new Date).getTime()/1e3)},i=function(){function e(){this.listeners={}}return e.prototype.addEventListener=function(e,t){Reflect.has(this.listeners,e)||(this.listeners[e]=[]);var n=this.listeners[e];return n.push(t),n.length-1},e.prototype.removeEventListener=function(e,t){if(Reflect.has(this.listeners,e))for(var n=this.listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return void n.splice(r,1)},e.prototype.dispatchEvent=function(e){if(!Reflect.has(this.listeners,e.type))return!0;for(var t=this.listeners[e.type],n=0,r=t.length;n<r;n++)t[n].call(this,e);return!e.defaultPrevented},e.prototype.modifyHandler=function(e,t,n){Reflect.has(this.listeners,e)&&"number"==typeof t&&(this.listeners[e][t]=n)},e.prototype.removeAllListeners=function(){this.listeners={}},e}(),o=new i,s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},c=[],u=[],l=function(e){var t=-1;c.some((function(r,i){return!!n(r[0],e.url)&&(t=i,!0)}))?u[t].push(e):(c.push([e.url]),u.push([e]))},p=window.WebSocket,f=["close","error","message","open"],d=function(r){function i(e,s){var a=r.call(this)||this;if(a.onclose=null,a.onerror=null,a.onmessage=null,a.onopen=null,a._url="",a._index=-1,a._readyState=i.CONNECTING,a._bufferedAmount=0,arguments.length<1)throw TypeError("Failed to construct 'WebSocket': 1 argument required, but only 0 present.");for(var l=0;l<c.length;l++)if(n(c[l][0],e)){console.log("ÂºÄÂßãÈìæÊé•");var f=t(e);if("string"==typeof f)throw new DOMException("Failed to construct 'WebSocket': "+f);return a._observeProps(),a._url=e,a._index=l,a._closeEventDict={code:1e3,reason:"Connection of mock WebSocket with url '"+a._url+"' is closed because you are so ugly.",wasClean:!0},a._attachEvents(),setTimeout((function(){a._readyState=i.OPEN,u[a._index].map((function(e){o.dispatchEvent({type:"_open",url:e.url,_id:e._id})}))}),h.configs.CONNECTING_TIME),a}return console.log("%cMock setting for url '"+e+"' not found, native WebSocket will be invoked.","color: red;"),new p(e,s)}return function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(i,r),i.prototype.send=function(t){if(arguments.length<1)throw new TypeError("Failed to execute 'send' on 'WebSocket': 1 argument required, but only 0 present.");if(this._readyState===i.CONNECTING)throw new DOMException("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.","InvalidStateError");if(this._readyState===i.OPEN){var n=e(t),r=n.dataToBeSent,s=u[this._index],a=this._bufferedAmount/h.configs.SEND_RATE*1e3;setTimeout((function(){s.map((function(e){var n=e.receiver;n&&n.call(e,r),o.dispatchEvent({type:"_receive",url:e.url,_id:e._id,data:t})}))}),a)}else console.log("WebSocket is already in CLOSING or CLOSED state.")},i.prototype.close=function(e,t){var n=this;if(void 0===e&&(e=1e3),e=Number(e),1e3!==(e=isNaN(e)||e<0?0:e>65535?65535:e)&&(e<3e3||e>4999))throw new DOMException("Failed to execute 'close' on 'WebSocket': \n        The code must be either 1000, or between 3000 and 4999. "+e+" is neither.","InvalidAccessError");this._readyState=i.CLOSING,setTimeout((function(){n._closeEventDict.code=e,t&&(n._closeEventDict.reason=t),n._readyState=i.CLOSED,n.removeAllListeners(),u[n._index].map((function(e){o.dispatchEvent({type:"_close",url:e.url,_id:e._id})}))}),h.configs.CLOSING_TIME)},i.prototype._attachEvents=function(){o.addEventListener("_message",this._dispatchMessageEvent.bind(this))},i.prototype._dispatchMessageEvent=function(e){n(e.url,this._url)&&this.dispatchEvent(this._defineEventProps(new MessageEvent("message",a({data:null,origin:this._url,lastEventId:"",source:null,ports:[]},e.messageEventDict))))},i.prototype._observeProps=function(){this._observeBinaryType(),this._observeBufferedAmount(),this._observeExtensions(),this._observeProtocol(),this._observeOnEvents(),this._observeReadyState(),this._observeUrl()},i.prototype._observeBinaryType=function(){var e=["blob","arraybuffer"],t="blob";Object.defineProperty(this,"binaryType",{configurable:!0,enumerable:!0,get:function(){return t},set:function(n){e.indexOf(n)>-1?t=n:console.warn("The provided value '"+n+"' is not a valid enum value of type BinaryType.")}})},i.prototype._observeBufferedAmount=function(){this._observeReadOnlyProps("bufferedAmount",0)},i.prototype._observeExtensions=function(){this._observeReadOnlyProps("extensions","")},i.prototype._observeProtocol=function(){this._observeReadOnlyProps("protocol","")},i.prototype._observeOnEvents=function(){var e=this;f.map((function(t){var n,r=null;Object.defineProperty(e,"on"+t,{configurable:!0,enumerable:!0,get:function(){return r},set:function(e){r?this.modifyHandler(t,n,e):n=this.addEventListener(t,e),r=e}})}))},i.prototype._observeReadyState=function(){var e=this;this._observeReadOnlyProps("readyState",i.CONNECTING,(function(t){switch(t){case i.OPEN:e.dispatchEvent(e._defineEventProps(new Event("open")));break;case i.CLOSED:e.dispatchEvent(e._defineEventProps(new CloseEvent("close",e._closeEventDict)))}}))},i.prototype._observeUrl=function(){this._observeReadOnlyProps("url","")},i.prototype._observeReadOnlyProps=function(e,t,n){var r=t;Object.defineProperty(this,"_"+e,{configurable:!0,enumerable:!1,get:function(){return r},set:function(t){r=t,n&&"function"==typeof n&&n.call(this,t),Object.defineProperty(this,e,{value:r,configurable:!0,enumerable:!0,writable:!1})}}),this["_"+e]=t},i.prototype._defineEventProps=function(e){var t=this;return["srcElement","currentTarget","target"].map((function(n){Object.defineProperty(e,n,{value:t,configurable:!0,enumerable:!0})})),e},i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i}(i);d.prototype.CONNECTING=d.CONNECTING,d.prototype.OPEN=d.OPEN,d.prototype.CLOSING=d.CLOSING,d.prototype.CLOSED=d.CLOSED,d._nativeWebSocket=p;var v=0,h=function(){function t(t){var i=this;this.timeLineTask={},this.IWSTaskList=[],this.sendTypeMap={},this.unRegisterTypeMap={},this.start=function(){var e=i.setting,t=e.url,r=e._id;o.addEventListener("_receive",(function(e){n(e.url,t)&&e._id===r&&i.receiver(e.data)})),o.addEventListener("_open",(function(e){n(e.url,t)&&e._id===r&&(i.execute(),console.log(i.setting.url,"mockÂ∑≤ÂºÄÂêØ"))})),o.addEventListener("_close",(function(e){n(e.url,t)&&e._id===r&&(i.close(),console.log(t,"mockÂ∑≤ÂÖ≥Èó≠"))}))},this.addTask=function(e){var t=e.sendType,n=e.unRegisterType;e.isExpire=!0,i.IWSTaskList.push(e);var r=i.IWSTaskList.length-1;i.sendTypeMap[t]=r,n&&(i.unRegisterTypeMap[n]=r)},this.close=function(){i.timeLineTask=[],i.IWSTaskList.forEach((function(e){e.isExpire=!0})),clearInterval(i.timer)},this.sendMsg=function(t,n){var r=e(JSON.stringify({type:t,timestamp:new Date,data:n}));o.dispatchEvent({type:"_message",url:i.url,messageEventDict:{data:r.dataToBeSent}})},this.addTimeLineTask=function(e,t){if(void 0===t&&(t=0),0!==t&&-1!==t){var n=r()+t;i.timeLineTask[n]||(i.timeLineTask[n]=[]),i.timeLineTask[n].push(e)}},this._sender=function(e,t){return JSON.stringify({type:t.messageType,timestamp:new Date,data:e})},this._receiver=function(e){var t=JSON.parse(e),n=t.type,r=t.data,o=i.sendTypeMap[n],s=i.unRegisterTypeMap[n];if(void 0!==o){var a=i.IWSTaskList[o];return a.sendData=a.registerFunc?a.registerFunc(a.sendData,r):r,void(a.isExpire&&(a.isExpire=!1,i.addTimeLineTask(a,1)))}if(void 0!==s){void 0===r&&i.removeTask(s);var c=i.IWSTaskList[s];c.sendData=c.unRegisterFunc?c.unRegisterFunc(c.sendData,r):r,c.isExpire=!0}},this.execute=function(){i.timer=window.setInterval((function(){var t=r();i.timeLineTask[t]&&(i.timeLineTask[t].forEach((function(t){if(!t.isExpire){t.mockFunc((function(n){var r=e(i.sender(n,t));o.dispatchEvent({type:"_message",url:i.url,messageEventDict:{data:r.dataToBeSent}})}),t.sendData),i.addTimeLineTask(t,t.time)}})),Reflect.deleteProperty(i.timeLineTask,t))}),1e3)},this.removeTask=function(e){i.IWSTaskList[e].isExpire=!0},t.url?(this.setting=t,this.url=t.url,this.sender=t.sender||this._sender,this.receiver=t.receiver||this._receiver,t._id=v++,l(t)):console.log("Url must be specified.")}return t.config=function(e){Object.assign(t.config,e)},t.configs={CONNECTING_TIME:100,CLOSING_TIME:100,SEND_RATE:1048576},t}();if(!Reflect.has(window,"WebSocket"))throw new Error("Your browser does not support WebSocket.");window.WebSocket=d;export default h;
//# sourceMappingURL=index.es.js.map
